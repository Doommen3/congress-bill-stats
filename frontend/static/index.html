<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Legislative Bill Stats</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/static/styles.css">
  <!-- Chart.js for timeline -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- D3.js for network graph -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="mb">
      <h1 class="h1">Legislative Bill Stats</h1>
      <p class="muted">Counts of bills sponsored and enacted (became law) by legislator.</p>
    </header>

    <!-- Legislature Toggle -->
    <section class="legislature-toggle">
      <div class="toggle-buttons">
        <button id="congressBtn" class="toggle-btn active">US Congress</button>
        <button id="illinoisBtn" class="toggle-btn">Illinois GA</button>
      </div>
    </section>

    <!-- Congress Controls -->
    <section id="congressControls" class="controls">
      <div class="control">
        <label>Congress</label>
        <input id="congressInput" type="number" min="81" value="119">
      </div>
      <div class="control">
        <label>Chamber</label>
        <select id="chamberFilter">
          <option value="both">Both</option>
          <option value="house">House</option>
          <option value="senate">Senate</option>
        </select>
      </div>
      <div class="control">
        <label>Search (name/state)</label>
        <input id="searchBox" type="text" placeholder="e.g., Smith or IL">
      </div>
      <div class="control buttons">
        <button id="loadBtn" class="btn">Load</button>
        <button id="exportBtn" class="btn secondary">Export CSV</button>
      </div>
    </section>

    <!-- Illinois Controls -->
    <section id="illinoisControls" class="controls" style="display: none;">
      <div class="control">
        <label>GA Session</label>
        <select id="ilSessionSelect">
          <option value="104">104th (2025-2026)</option>
          <option value="103">103rd (2023-2024)</option>
        </select>
      </div>
      <div class="control">
        <label>Chamber</label>
        <select id="ilChamberFilter">
          <option value="both">Both</option>
          <option value="house">House</option>
          <option value="senate">Senate</option>
        </select>
      </div>
      <div class="control">
        <label>Search (name/district)</label>
        <input id="ilSearchBox" type="text" placeholder="e.g., Smith or 5">
      </div>
      <div class="control buttons">
        <button id="ilLoadBtn" class="btn">Load</button>
        <button id="ilExportBtn" class="btn secondary">Export CSV</button>
      </div>
    </section>

    <div id="status" class="muted mb"></div>

    <!-- Party Comparison Stats -->
    <section id="partyStats" class="party-stats mb">
      <div class="stat-card dem">
        <div class="stat-party">Democrats</div>
        <div class="stat-row"><span class="stat-label">Avg Sponsored</span><span id="demSponsored" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Enacted</span><span id="demEnacted" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Success Rate</span><span id="demSuccessRate" class="stat-value">—</span></div>
      </div>
      <div class="stat-card rep">
        <div class="stat-party">Republicans</div>
        <div class="stat-row"><span class="stat-label">Avg Sponsored</span><span id="repSponsored" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Enacted</span><span id="repEnacted" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Success Rate</span><span id="repSuccessRate" class="stat-value">—</span></div>
      </div>
      <div class="stat-card overall">
        <div class="stat-party">Overall</div>
        <div class="stat-row"><span class="stat-label">Avg Sponsored</span><span id="allSponsored" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Enacted</span><span id="allEnacted" class="stat-value">—</span></div>
        <div class="stat-row"><span class="stat-label">Avg Success Rate</span><span id="allSuccessRate" class="stat-value">—</span></div>
      </div>
    </section>

    <!-- Leaderboards -->
    <section id="leaderboards" class="leaderboards mb">
      <div class="leaderboard-tabs">
        <button class="lb-tab active" data-lb="sponsored">Most Bills Sponsored</button>
        <button class="lb-tab" data-lb="enacted">Most Bills Enacted</button>
        <button class="lb-tab" data-lb="success">Highest Success Rate</button>
        <button class="lb-tab" data-lb="bipartisan">Most Bipartisan</button>
        <button class="lb-tab" data-lb="velocity">Fastest to Enact</button>
      </div>
      <div class="leaderboard-content">
        <ol id="leaderboardList" class="leaderboard-list"></ol>
      </div>
    </section>

    <!-- Timeline View (Illinois only) -->
    <section id="timelineSection" class="timeline-section mb" style="display: none;">
      <h3 class="section-title">Legislative Activity Timeline</h3>
      <div class="timeline-chart-container">
        <canvas id="timelineChart"></canvas>
      </div>
    </section>

    <!-- Co-sponsor Network (Illinois only) -->
    <section id="networkSection" class="network-section mb" style="display: none;">
      <h3 class="section-title">Co-sponsor Graph</h3>
      <div class="network-controls">
        <label>
          Graph type:
          <select id="networkGraphMode">
            <option value="network">Network analysis</option>
            <option value="edge_bundling">Hierarchical edge bundling</option>
          </select>
        </label>
        <label><input type="checkbox" id="networkShowLabels" checked> Show names</label>
        <label>Min connections: <input type="number" id="networkMinConnections" value="3" min="1" max="20" style="width: 60px;"></label>
        <button id="networkRefresh" class="btn secondary">Refresh</button>
        <span class="network-zoom-controls">
          <button id="networkZoomIn" class="btn secondary btn-sm" title="Zoom In">+</button>
          <button id="networkZoomOut" class="btn secondary btn-sm" title="Zoom Out">−</button>
          <button id="networkFitView" class="btn secondary btn-sm" title="Fit to View">Fit</button>
        </span>
      </div>
      <div id="networkContainer" class="network-container"></div>
      <p id="networkHint" class="network-hint muted tiny">Drag to pan, scroll to zoom. Click "Fit" to see all nodes.</p>
    </section>

    <div class="card">
      <!-- Congress Table -->
      <table id="dataTable">
        <thead>
          <tr>
            <th data-key="sponsorName" class="th-sort">Legislator</th>
            <th data-key="chamber" class="th-sort">Chamber</th>
            <th data-key="party" class="th-sort">Party</th>
            <th data-key="state" class="th-sort">State</th>
            <th data-key="primary_sponsor_total" class="th-sort right">Primary</th>
            <th data-key="cosponsor_total" class="th-sort right">Cosponsor</th>
            <th data-key="original_cosponsor_total" class="th-sort right">Original Cosponsor</th>
            <th data-key="public_law_count" class="th-sort right">Public Laws</th>
            <th data-key="private_law_count" class="th-sort right">Private Laws</th>
            <th data-key="enacted_total" class="th-sort right">Total Laws</th>
            <th data-key="success_rate" class="th-sort right">Success %</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <!-- Illinois Table (hidden by default) -->
      <table id="ilDataTable" style="display: none;">
        <thead>
          <tr>
            <th data-key="sponsorName" class="th-sort il-sort">Legislator</th>
            <th data-key="chamber" class="th-sort il-sort">Chamber</th>
            <th data-key="party" class="th-sort il-sort">Party</th>
            <th data-key="district" class="th-sort il-sort right">District</th>
            <th data-key="primary_sponsor_total" class="th-sort il-sort right">Primary</th>
            <th data-key="chief_co_sponsor_total" class="th-sort il-sort right">Chief Co</th>
            <th data-key="co_sponsor_total" class="th-sort il-sort right">Co</th>
            <th data-key="enacted_total" class="th-sort il-sort right">Enacted</th>
            <th data-key="success_rate" class="th-sort il-sort right">Success %</th>
            <th data-key="avg_days_to_enactment" class="th-sort il-sort right">Avg Days</th>
            <th data-key="bipartisan_score" class="th-sort il-sort right">Bipartisan % (adj)</th>
          </tr>
        </thead>
        <tbody id="ilTbody"></tbody>
      </table>
    </div>

    <div id="summary" class="summary muted mb"></div>

    <p id="dataNote" class="tiny muted">
      Law counts use the Congress.gov /law endpoint for accurate enacted legislation data. First load may take a few minutes; then it's cached.
    </p>
  </div>

  <script src="/static/app.js" defer></script>
</body>
</html>
